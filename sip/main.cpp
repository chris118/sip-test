//
//  main.cpp
//  sip
//
//  Created by Chris on 2018/7/12.
//  Copyright © 2018年 Chris. All rights reserved.
//

#include <iostream>
#include <string>
#include <vector>
#include <stdio.h>
#include <sys/types.h>
#include <ifaddrs.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include "siputil.hpp"
#include "tool.hpp"

using namespace std;

int cSip_length = 562;
unsigned char cSip[562] = {0x4d,0x45,0x53,0x53,0x41,0x47,0x45,0x20,0x73,0x69,0x70,0x3a,0x37,0x30,0x33,0x37,0x39,0x34,0x33,0x38,0x37,0x30,0x30,0x33,0x30,0x31,0x30,0x30,0x35,0x31,0x40,0x31,0x31,0x31,0x2e,0x32,0x35,0x2e,0x39,0x2e,0x31,0x34,0x38,0x3a,0x35,0x30,0x36,0x30,0x20,0x53,0x49,0x50,0x2f,0x32,0x2e,0x30,0x0d,0x0a,0x56,0x69,0x61,0x3a,0x20,0x53,0x49,0x50,0x2f,0x32,0x2e,0x30,0x2f,0x55,0x44,0x50,0x20,0x32,0x2e,0x30,0x2e,0x30,0x2e,0x35,0x3a,0x35,0x30,0x36,0x30,0x3b,0x62,0x72,0x61,0x6e,0x63,0x68,0x3d,0x7a,0x39,0x68,0x47,0x34,0x62,0x4b,0x32,0x33,0x30,0x64,0x61,0x0d,0x0a,0x4d,0x61,0x78,0x2d,0x46,0x6f,0x72,0x77,0x61,0x72,0x64,0x73,0x3a,0x20,0x36,0x39,0x0d,0x0a,0x54,0x6f,0x3a,0x20,0x3c,0x73,0x69,0x70,0x3a,0x37,0x30,0x33,0x37,0x39,0x34,0x33,0x38,0x37,0x30,0x30,0x33,0x30,0x31,0x30,0x30,0x35,0x31,0x40,0x32,0x2e,0x30,0x2e,0x30,0x2e,0x35,0x3a,0x35,0x30,0x36,0x30,0x3e,0x0d,0x0a,0x46,0x72,0x6f,0x6d,0x3a,0x20,0x3c,0x73,0x69,0x70,0x3a,0x37,0x30,0x33,0x37,0x39,0x34,0x33,0x38,0x37,0x30,0x30,0x33,0x30,0x31,0x30,0x30,0x35,0x31,0x40,0x32,0x2e,0x30,0x2e,0x30,0x2e,0x35,0x3a,0x35,0x30,0x36,0x30,0x3e,0x3b,0x74,0x61,0x67,0x3d,0x62,0x65,0x65,0x33,0x32,0x36,0x36,0x66,0x0d,0x0a,0x43,0x61,0x6c,0x6c,0x2d,0x49,0x44,0x3a,0x20,0x33,0x30,0x63,0x36,0x39,0x38,0x34,0x32,0x39,0x32,0x32,0x34,0x40,0x32,0x36,0x2e,0x34,0x37,0x2e,0x32,0x30,0x38,0x2e,0x33,0x33,0x0d,0x0a,0x43,0x53,0x65,0x71,0x3a,0x20,0x31,0x20,0x4d,0x45,0x53,0x53,0x41,0x47,0x45,0x0d,0x0a,0x45,0x78,0x70,0x69,0x72,0x65,0x73,0x3a,0x20,0x36,0x30,0x30,0x0d,0x0a,0x55,0x73,0x65,0x72,0x2d,0x41,0x67,0x65,0x6e,0x74,0x3a,0x20,0x4d,0x6a,0x53,0x69,0x70,0x20,0x31,0x2e,0x35,0x2e,0x33,0x0d,0x0a,0x43,0x6f,0x6e,0x74,0x65,0x6e,0x74,0x2d,0x4c,0x65,0x6e,0x67,0x74,0x68,0x3a,0x20,0x31,0x38,0x38,0x0d,0x0a,0x43,0x6f,0x6e,0x74,0x65,0x6e,0x74,0x2d,0x54,0x79,0x70,0x65,0x3a,0x20,0x61,0x70,0x70,0x6c,0x69,0x63,0x61,0x74,0x69,0x6f,0x6e,0x2f,0x78,0x6d,0x6c,0x0d,0x0a,0x0d,0x0a,0x3c,0x3f,0x78,0x6d,0x6c,0x20,0x76,0x65,0x72,0x73,0x69,0x6f,0x6e,0x3d,0x22,0x31,0x2e,0x30,0x22,0x20,0x65,0x6e,0x63,0x6f,0x64,0x69,0x6e,0x67,0x3d,0x22,0x55,0x54,0x46,0x2d,0x38,0x22,0x3f,0x3e,0x0a,0x3c,0x53,0x49,0x50,0x5f,0x58,0x4d,0x4c,0x20,0x45,0x76,0x65,0x6e,0x74,0x54,0x79,0x70,0x65,0x3d,0x22,0x43,0x6f,0x6e,0x74,0x72,0x6f,0x6c,0x5f,0x43,0x61,0x6d,0x65,0x72,0x61,0x22,0x3e,0x0a,0x3c,0x49,0x74,0x65,0x6d,0x20,0x43,0x6f,0x64,0x65,0x3d,0x22,0x37,0x30,0x33,0x37,0x39,0x34,0x33,0x38,0x37,0x30,0x30,0x33,0x30,0x31,0x30,0x30,0x35,0x31,0x22,0x20,0x43,0x6f,0x6d,0x6d,0x61,0x6e,0x64,0x3d,0x22,0x32,0x33,0x30,0x35,0x22,0x20,0x43,0x6f,0x6d,0x6d,0x61,0x6e,0x64,0x50,0x61,0x72,0x61,0x31,0x3d,0x22,0x35,0x22,0x20,0x43,0x6f,0x6d,0x6d,0x61,0x6e,0x64,0x50,0x61,0x72,0x61,0x32,0x3d,0x22,0x35,0x22,0x20,0x43,0x6f,0x6d,0x6d,0x61,0x6e,0x64,0x50,0x61,0x72,0x61,0x33,0x3d,0x22,0x22,0x20,0x2f,0x3e,0x0a,0x3c,0x2f,0x53,0x49,0x50,0x5f,0x58,0x4d,0x4c,0x3e,0x0a,0x0a};

void formatHex() {
    string hexStr = "4d455353414745207369703a373033373934333837303033303130303531403131312e32352e392e3134383a35303630205349502f322e300d0a5669613a205349502f322e302f55445020322e302e302e353a353036303b6272616e63683d7a39684734624b32333064610d0a4d61782d466f7277617264733a2036390d0a546f3a203c7369703a37303337393433383730303330313030353140322e302e302e353a353036303e0d0a46726f6d3a203c7369703a37303337393433383730303330313030353140322e302e302e353a353036303e3b7461673d62656533323636660d0a43616c6c2d49443a203330633639383432393232344032362e34372e3230382e33330d0a435365713a2031204d4553534147450d0a457870697265733a203630300d0a557365722d4167656e743a204d6a53697020312e352e330d0a436f6e74656e742d4c656e6774683a203138380d0a436f6e74656e742d547970653a206170706c69636174696f6e2f786d6c0d0a0d0a3c3f786d6c2076657273696f6e3d22312e302220656e636f64696e673d225554462d38223f3e0a3c5349505f584d4c204576656e74547970653d22436f6e74726f6c5f43616d657261223e0a3c4974656d20436f64653d223730333739343338373030333031303035312220436f6d6d616e643d22323330352220436f6d6d616e6450617261313d22352220436f6d6d616e6450617261323d22352220436f6d6d616e6450617261333d2222202f3e0a3c2f5349505f584d4c3e0a0a";
         int counter = 0;
        for(int i = 0; i < hexStr.length() - 1; i = i + 2){
            counter++;
            cout << "0x" << hexStr.c_str()[i] << hexStr.c_str()[i+1] << ",";
        }
    
        cout << endl << counter << endl;
}


int main(int argc, const char * argv[]) {
    formatHex();
    cout << cSip << endl;


    SIPUtil siputil;
    int new_sip_length = 0;
    
    string new_sip = siputil.change_control_camera_ip((char *)cSip, cSip_length, "127.0.0.1", "127.0.0.1:9000", "0.0.0.0");
    cout << new_sip << endl;
    
//    shared_ptr<char> new_sip =  siputil.change_register_ip((char *)cSip, cSip_length, "127.0.0.1", new_sip_length);
    
//    shared_ptr<char> new_sip = siputil.change_invite_ip_200ok((char *)cSip, cSip_length, "127.0.0.1", "127.0.0.1:9000", new_sip_length);
    
//    if(new_sip == nullptr) {
//
//    }else {
//         printf("%s", new_sip.get());
//    }

    
//    string new_sip = siputil.change_control_camera_ip((char*)cSip, cSip_length, "127.0.0.1", "127.0.0.1:8000", "0.0.0.0:5060");
//        printf("%s", new_sip.get());
    
//    string subscrib_ok_200 = siputil.get_subscrit_200_ok(cSip, cSip_length);
//    cout << subscrib_ok_200 << endl;
    
    
//    shared_ptr<char> new_sip = siputil.change_invite_ip(cSip, cSip_length, "127.0.0.1", new_sip_length);
//    printf("%s", new_sip.get());

//    shared_ptr<char> new_sip = siputil.change_rtsp_ip_200ok(cSip, cSip_length, "127.0.0.1", "8.8.8.8", new_sip_length);
//    printf("%s", new_sip.get());
    
//     if(siputil.is_event_type(cSip, cSip_length, "Push_Resourse")) {
//         shared_ptr<char> new_sip = siputil.makeBatteryNotify(cSip, cSip_length, new_sip_length);
//         printf("%s", new_sip.get());
//     }

//    printBuffer(new_sip.get(), new_sip_length, "");
    
//    if(siputil.is_event_type(cSip, cSip_length, "Response_History_Video")) {
//        shared_ptr<char> new_sip = siputil.change_replay_ip(cSip, cSip_length, "127.0.0.1:554", new_sip_length);
//        printf("%s", new_sip.get());
//        printBuffer(new_sip.get(), new_sip_length, "");
//    }
    return 0;
}






