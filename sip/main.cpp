//
//  main.cpp
//  sip
//
//  Created by Chris on 2018/7/12.
//  Copyright © 2018年 Chris. All rights reserved.
//

#include <iostream>
#include <string>
#include <vector>
#include <stdio.h>
#include <sys/types.h>
#include <ifaddrs.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include "siputil.hpp"
#include "tool.hpp"

using namespace std;

int cSip_length = 616;
unsigned char cSip[616] = {0x49,0x4e,0x56,0x49,0x54,0x45,0x20,0x73,0x69,0x70,0x3a,0x37,0x30,0x33,0x37,0x39,0x34,0x33,0x38,0x37,0x30,0x30,0x33,0x30,0x31,0x30,0x30,0x35,0x31,0x40,0x31,0x31,0x31,0x2e,0x32,0x35,0x2e,0x39,0x2e,0x31,0x34,0x38,0x3a,0x35,0x30,0x36,0x30,0x20,0x53,0x49,0x50,0x2f,0x32,0x2e,0x30,0x0d,0x0a,0x56,0x69,0x61,0x3a,0x20,0x53,0x49,0x50,0x2f,0x32,0x2e,0x30,0x2f,0x55,0x44,0x50,0x20,0x32,0x36,0x2e,0x34,0x37,0x2e,0x32,0x30,0x38,0x2e,0x33,0x33,0x3a,0x35,0x30,0x36,0x30,0x3b,0x62,0x72,0x61,0x6e,0x63,0x68,0x3d,0x7a,0x39,0x68,0x47,0x34,0x62,0x4b,0x62,0x32,0x35,0x30,0x35,0x0d,0x0a,0x4d,0x61,0x78,0x2d,0x46,0x6f,0x72,0x77,0x61,0x72,0x64,0x73,0x3a,0x20,0x36,0x39,0x0d,0x0a,0x54,0x6f,0x3a,0x20,0x3c,0x73,0x69,0x70,0x3a,0x37,0x30,0x33,0x37,0x39,0x34,0x33,0x38,0x37,0x30,0x30,0x33,0x30,0x31,0x30,0x30,0x35,0x31,0x40,0x32,0x36,0x2e,0x34,0x37,0x2e,0x32,0x30,0x38,0x2e,0x33,0x33,0x3e,0x0d,0x0a,0x46,0x72,0x6f,0x6d,0x3a,0x20,0x3c,0x73,0x69,0x70,0x3a,0x37,0x30,0x33,0x37,0x39,0x34,0x33,0x38,0x37,0x30,0x30,0x33,0x30,0x31,0x30,0x30,0x35,0x31,0x40,0x32,0x36,0x2e,0x34,0x37,0x2e,0x32,0x30,0x38,0x2e,0x33,0x33,0x3e,0x3b,0x74,0x61,0x67,0x3d,0x37,0x35,0x31,0x36,0x36,0x62,0x31,0x63,0x0d,0x0a,0x43,0x61,0x6c,0x6c,0x2d,0x49,0x44,0x3a,0x20,0x36,0x38,0x39,0x61,0x37,0x62,0x63,0x62,0x61,0x62,0x31,0x39,0x40,0x32,0x36,0x2e,0x34,0x37,0x2e,0x32,0x30,0x38,0x2e,0x33,0x33,0x0d,0x0a,0x43,0x53,0x65,0x71,0x3a,0x20,0x31,0x20,0x49,0x4e,0x56,0x49,0x54,0x45,0x0d,0x0a,0x52,0x65,0x63,0x6f,0x72,0x64,0x2d,0x52,0x6f,0x75,0x74,0x65,0x3a,0x20,0x3c,0x73,0x69,0x70,0x3a,0x32,0x36,0x2e,0x34,0x37,0x2e,0x32,0x30,0x38,0x2e,0x33,0x33,0x3b,0x6c,0x72,0x3e,0x0d,0x0a,0x43,0x6f,0x6e,0x74,0x61,0x63,0x74,0x3a,0x20,0x3c,0x73,0x69,0x70,0x3a,0x37,0x30,0x33,0x37,0x39,0x34,0x33,0x38,0x37,0x30,0x30,0x33,0x30,0x31,0x30,0x30,0x35,0x31,0x40,0x32,0x36,0x2e,0x34,0x37,0x2e,0x32,0x30,0x38,0x2e,0x33,0x33,0x3e,0x0d,0x0a,0x45,0x78,0x70,0x69,0x72,0x65,0x73,0x3a,0x20,0x36,0x30,0x30,0x0d,0x0a,0x55,0x73,0x65,0x72,0x2d,0x41,0x67,0x65,0x6e,0x74,0x3a,0x20,0x4d,0x6a,0x53,0x69,0x70,0x20,0x31,0x2e,0x35,0x2e,0x33,0x0d,0x0a,0x43,0x6f,0x6e,0x74,0x65,0x6e,0x74,0x2d,0x4c,0x65,0x6e,0x67,0x74,0x68,0x3a,0x20,0x31,0x35,0x34,0x0d,0x0a,0x43,0x6f,0x6e,0x74,0x65,0x6e,0x74,0x2d,0x54,0x79,0x70,0x65,0x3a,0x20,0x61,0x70,0x70,0x6c,0x69,0x63,0x61,0x74,0x69,0x6f,0x6e,0x2f,0x73,0x64,0x70,0x0d,0x0a,0x0d,0x0a,0x76,0x3d,0x30,0x6f,0x3d,0x2d,0x20,0x30,0x20,0x30,0x20,0x49,0x4e,0x20,0x49,0x50,0x34,0x20,0x31,0x30,0x2e,0x31,0x32,0x36,0x2e,0x31,0x33,0x2e,0x32,0x30,0x37,0x73,0x3d,0x2d,0x63,0x3d,0x49,0x4e,0x20,0x49,0x50,0x34,0x20,0x32,0x36,0x2e,0x34,0x37,0x2e,0x32,0x30,0x38,0x2e,0x33,0x34,0x6d,0x3d,0x76,0x69,0x64,0x65,0x6f,0x20,0x35,0x38,0x31,0x37,0x38,0x20,0x52,0x54,0x50,0x2f,0x41,0x56,0x50,0x20,0x31,0x30,0x30,0x61,0x3d,0x72,0x74,0x70,0x6d,0x61,0x70,0x3a,0x31,0x30,0x30,0x20,0x48,0x32,0x36,0x34,0x2f,0x39,0x30,0x30,0x30,0x30,0x61,0x3d,0x66,0x6d,0x74,0x70,0x3a,0x31,0x30,0x30,0x20,0x43,0x49,0x46,0x3d,0x31,0x3b,0x34,0x43,0x49,0x46,0x3d,0x31,0x3b,0x46,0x3d,0x31,0x3b,0x4b,0x3d,0x31,0x61,0x3d,0x63,0x6f,0x6e,0x74,0x72,0x6f,0x6c,0x3a,0x73,0x74,0x72,0x65,0x61,0x6d,0x69,0x64,0x3d,0x30};

void formatHex() {
    string hexStr = "494e56495445207369703a373033373934333837303033303130303531403131312e32352e392e3134383a35303630205349502f322e300d0a5669613a205349502f322e302f5544502032362e34372e3230382e33333a353036303b6272616e63683d7a39684734624b62323530350d0a4d61782d466f7277617264733a2036390d0a546f3a203c7369703a3730333739343338373030333031303035314032362e34372e3230382e33333e0d0a46726f6d3a203c7369703a3730333739343338373030333031303035314032362e34372e3230382e33333e3b7461673d37353136366231630d0a43616c6c2d49443a203638396137626362616231394032362e34372e3230382e33330d0a435365713a203120494e564954450d0a5265636f72642d526f7574653a203c7369703a32362e34372e3230382e33333b6c723e0d0a436f6e746163743a203c7369703a3730333739343338373030333031303035314032362e34372e3230382e33333e0d0a457870697265733a203630300d0a557365722d4167656e743a204d6a53697020312e352e330d0a436f6e74656e742d4c656e6774683a203135340d0a436f6e74656e742d547970653a206170706c69636174696f6e2f7364700d0a0d0a763d306f3d2d2030203020494e204950342031302e3132362e31332e323037733d2d633d494e204950342032362e34372e3230382e33346d3d766964656f203538313738205254502f41565020313030613d7274706d61703a31303020483236342f3930303030613d666d74703a313030204349463d313b344349463d313b463d313b4b3d31613d636f6e74726f6c3a73747265616d69643d30";
         int counter = 0;
        for(int i = 0; i < hexStr.length() - 1; i = i + 2){
            counter++;
            cout << "0x" << hexStr.c_str()[i] << hexStr.c_str()[i+1] << ",";
        }
    
        cout << endl << counter << endl;
}


int main(int argc, const char * argv[]) {
    formatHex();
    cout << std::string((char*)cSip) << endl;


    SIPUtil siputil;
    int new_sip_length = 0;
    
    string old_ip = siputil.get_invite_platform_video_ip((char *)cSip, cSip_length);
//    cout << "<<<<<<<<<<<<<<<<<<<<<<<<<" << old_ip << endl;
    
    
    shared_ptr<char> new_sip = siputil.change_invite_ip((char *)cSip, cSip_length, "127.0.0.1", "1.1.1.1", "1.1.1.1:9000", new_sip_length);
    printf(">>>>>>>>>>>>>>> \n\n %s", new_sip.get());
    
//    shared_ptr<char> new_sip = siputil.change_notify_ip((char *)cSip, cSip_length, "127.0.0.1:9001", new_sip_length);
//
//     printf("%s", new_sip.get());
    
//    string new_sip = siputil.change_control_camera_ip((char *)cSip, cSip_length, "127.0.0.1", "127.0.0.1:9000", "0.0.0.0");
//    cout << new_sip << endl;
    
//    shared_ptr<char> new_sip =  siputil.change_register_ip((char *)cSip, cSip_length, "127.0.0.1", new_sip_length);
    
//    shared_ptr<char> new_sip = siputil.change_invite_ip_200ok((char *)cSip, cSip_length, "127.0.0.1", "127.0.0.1:9000", new_sip_length);
    
//    if(new_sip == nullptr) {
//
//    }else {
//         printf("%s", new_sip.get());
//    }

    
//    string new_sip = siputil.change_control_camera_ip((char*)cSip, cSip_length, "127.0.0.1", "127.0.0.1:8000", "0.0.0.0:5060");
//        printf("%s", new_sip.get());
    
//    string subscrib_ok_200 = siputil.get_subscrit_200_ok(cSip, cSip_length);
//    cout << subscrib_ok_200 << endl;
    
    
//    shared_ptr<char> new_sip = siputil.change_invite_ip(cSip, cSip_length, "127.0.0.1", new_sip_length);
//    printf("%s", new_sip.get());

//    shared_ptr<char> new_sip = siputil.change_rtsp_ip_200ok(cSip, cSip_length, "127.0.0.1", "8.8.8.8", new_sip_length);
//    printf("%s", new_sip.get());
    
//     if(siputil.is_event_type(cSip, cSip_length, "Push_Resourse")) {
//         shared_ptr<char> new_sip = siputil.makeBatteryNotify(cSip, cSip_length, new_sip_length);
//         printf("%s", new_sip.get());
//     }

//    printBuffer(new_sip.get(), new_sip_length, "");
    
//    if(siputil.is_event_type(cSip, cSip_length, "Response_History_Video")) {
//        shared_ptr<char> new_sip = siputil.change_replay_ip(cSip, cSip_length, "127.0.0.1:554", new_sip_length);
//        printf("%s", new_sip.get());
//        printBuffer(new_sip.get(), new_sip_length, "");
//    }
    return 0;
}




