//
//  main.cpp
//  sip
//
//  Created by Chris on 2018/7/12.
//  Copyright © 2018年 Chris. All rights reserved.
//

#include <iostream>
#include <string>
#include <vector>
#include <stdio.h>
#include <sys/types.h>
#include <ifaddrs.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include "siputil.hpp"
#include "tool.hpp"

using namespace std;

int cSip_length = 734;
unsigned char cSip[734] = {0x49,0x4e,0x56,0x49,0x54,0x45,0x20,0x73,0x69,0x70,0x3a,0x33,0x30,0x30,0x31,0x39,0x30,0x30,0x30,0x30,0x30,0x30,0x33,0x30,0x34,0x30,0x30,0x30,0x36,0x40,0x31,0x31,0x37,0x2e,0x31,0x33,0x36,0x2e,0x34,0x35,0x2e,0x32,0x31,0x3a,0x35,0x39,0x34,0x35,0x36,0x3b,0x74,0x72,0x61,0x6e,0x73,0x70,0x6f,0x72,0x74,0x3d,0x55,0x44,0x50,0x20,0x53,0x49,0x50,0x2f,0x32,0x2e,0x30,0x0a,0x56,0x69,0x61,0x3a,0x20,0x53,0x49,0x50,0x2f,0x32,0x2e,0x30,0x2f,0x55,0x44,0x50,0x20,0x31,0x30,0x2e,0x32,0x31,0x39,0x2e,0x37,0x2e,0x32,0x33,0x39,0x3a,0x32,0x31,0x31,0x30,0x39,0x3b,0x62,0x72,0x61,0x6e,0x63,0x68,0x3d,0x7a,0x39,0x68,0x47,0x34,0x62,0x4b,0x55,0x47,0x62,0x47,0x4b,0x58,0x79,0x64,0x6b,0x6a,0x42,0x67,0x77,0x77,0x6d,0x4b,0x43,0x41,0x35,0x61,0x64,0x74,0x72,0x72,0x34,0x62,0x4d,0x69,0x69,0x30,0x51,0x30,0x3b,0x72,0x70,0x6f,0x72,0x74,0x0a,0x43,0x53,0x65,0x71,0x3a,0x20,0x31,0x20,0x49,0x4e,0x56,0x49,0x54,0x45,0x0a,0x46,0x72,0x6f,0x6d,0x3a,0x20,0x3c,0x73,0x69,0x70,0x3a,0x33,0x30,0x30,0x30,0x39,0x30,0x30,0x30,0x30,0x30,0x30,0x34,0x30,0x32,0x30,0x30,0x30,0x32,0x40,0x31,0x30,0x2e,0x32,0x31,0x39,0x2e,0x37,0x2e,0x32,0x33,0x39,0x3a,0x32,0x31,0x31,0x30,0x39,0x3e,0x3b,0x74,0x61,0x67,0x3d,0x4a,0x35,0x79,0x77,0x6e,0x66,0x48,0x51,0x0a,0x54,0x6f,0x3a,0x20,0x3c,0x73,0x69,0x70,0x3a,0x33,0x30,0x30,0x31,0x39,0x30,0x30,0x30,0x30,0x30,0x30,0x33,0x30,0x34,0x30,0x30,0x30,0x36,0x40,0x31,0x31,0x37,0x2e,0x31,0x33,0x36,0x2e,0x34,0x35,0x2e,0x32,0x31,0x3a,0x35,0x39,0x34,0x35,0x36,0x3e,0x0a,0x43,0x61,0x6c,0x6c,0x2d,0x49,0x44,0x3a,0x20,0x62,0x66,0x33,0x39,0x31,0x31,0x64,0x37,0x2d,0x38,0x38,0x64,0x31,0x2d,0x34,0x63,0x65,0x65,0x2d,0x62,0x35,0x34,0x66,0x2d,0x31,0x66,0x37,0x30,0x30,0x32,0x66,0x35,0x66,0x63,0x36,0x63,0x0a,0x43,0x6f,0x6e,0x74,0x61,0x63,0x74,0x3a,0x20,0x3c,0x73,0x69,0x70,0x3a,0x33,0x30,0x30,0x30,0x39,0x30,0x30,0x30,0x30,0x30,0x30,0x34,0x30,0x32,0x30,0x30,0x30,0x32,0x40,0x31,0x30,0x2e,0x32,0x31,0x39,0x2e,0x37,0x2e,0x32,0x33,0x39,0x3a,0x32,0x31,0x31,0x30,0x39,0x3e,0x0a,0x4d,0x61,0x78,0x2d,0x46,0x6f,0x72,0x77,0x61,0x72,0x64,0x73,0x3a,0x20,0x37,0x30,0x0a,0x55,0x73,0x65,0x72,0x2d,0x41,0x67,0x65,0x6e,0x74,0x3a,0x20,0x47,0x6f,0x53,0x49,0x50,0x0a,0x43,0x6f,0x6e,0x74,0x65,0x6e,0x74,0x2d,0x4c,0x65,0x6e,0x67,0x74,0x68,0x3a,0x20,0x31,0x37,0x35,0x0a,0x43,0x6f,0x6e,0x74,0x65,0x6e,0x74,0x2d,0x54,0x79,0x70,0x65,0x3a,0x20,0x61,0x70,0x70,0x6c,0x69,0x63,0x61,0x74,0x69,0x6f,0x6e,0x2f,0x73,0x64,0x70,0x0a,0x41,0x6c,0x6c,0x6f,0x77,0x3a,0x20,0x49,0x4e,0x56,0x49,0x54,0x45,0x2c,0x20,0x41,0x43,0x4b,0x2c,0x20,0x42,0x59,0x45,0x2c,0x20,0x43,0x41,0x4e,0x43,0x45,0x4c,0x2c,0x20,0x49,0x4e,0x46,0x4f,0x2c,0x20,0x4f,0x50,0x54,0x49,0x4f,0x4e,0x53,0x2c,0x20,0x52,0x45,0x47,0x49,0x53,0x54,0x45,0x52,0x2c,0x20,0x4e,0x4f,0x54,0x49,0x46,0x59,0x0a,0x53,0x75,0x70,0x70,0x6f,0x72,0x74,0x65,0x64,0x3a,0x20,0x72,0x65,0x70,0x6c,0x61,0x63,0x65,0x73,0x2c,0x20,0x6f,0x75,0x74,0x62,0x6f,0x75,0x6e,0x64,0x0a,0x0a,0x76,0x3d,0x30,0x0a,0x6f,0x3d,0x2d,0x20,0x30,0x20,0x30,0x20,0x49,0x4e,0x20,0x49,0x50,0x34,0x20,0x32,0x32,0x30,0x2e,0x31,0x37,0x31,0x2e,0x31,0x2e,0x31,0x36,0x35,0x0a,0x73,0x3d,0x2d,0x0a,0x63,0x3d,0x49,0x4e,0x20,0x49,0x50,0x34,0x20,0x32,0x32,0x30,0x2e,0x31,0x37,0x31,0x2e,0x31,0x2e,0x31,0x36,0x35,0x0a,0x6d,0x3d,0x76,0x69,0x64,0x65,0x6f,0x20,0x32,0x34,0x38,0x34,0x30,0x20,0x52,0x54,0x50,0x2f,0x41,0x56,0x50,0x20,0x31,0x30,0x30,0x0a,0x61,0x3d,0x72,0x74,0x70,0x6d,0x61,0x70,0x3a,0x31,0x30,0x30,0x20,0x48,0x2e,0x32,0x36,0x34,0x2f,0x39,0x30,0x30,0x30,0x30,0x0a,0x61,0x3d,0x66,0x6d,0x74,0x70,0x3a,0x31,0x30,0x30,0x20,0x43,0x49,0x46,0x3d,0x31,0x3b,0x34,0x43,0x49,0x46,0x3d,0x31,0x3b,0x46,0x3d,0x31,0x3b,0x4b,0x3d,0x31,0x0a,0x61,0x3d,0x72,0x65,0x63,0x76,0x6f,0x6e,0x6c,0x79,0x0a,0x61,0x3d,0x72,0x61,0x74,0x65,0x3a,0x6d,0x61,0x69,0x6e,0x0a};

void formatHex() {
    string hexStr = "494e56495445207369703a333030313930303030303033303430303036403131372e3133362e34352e32313a35393435363b7472616e73706f72743d554450205349502f322e300a5669613a205349502f322e302f5544502031302e3231392e372e3233393a32313130393b6272616e63683d7a39684734624b554762474b5879646b6a426777776d4b434135616474727234624d69693051303b72706f72740a435365713a203120494e564954450a46726f6d3a203c7369703a3330303039303030303030343032303030324031302e3231392e372e3233393a32313130393e3b7461673d4a3579776e6648510a546f3a203c7369703a333030313930303030303033303430303036403131372e3133362e34352e32313a35393435363e0a43616c6c2d49443a2062663339313164372d383864312d346365652d623534662d3166373030326635666336630a436f6e746163743a203c7369703a3330303039303030303030343032303030324031302e3231392e372e3233393a32313130393e0a4d61782d466f7277617264733a2037300a557365722d4167656e743a20476f5349500a436f6e74656e742d4c656e6774683a203137350a436f6e74656e742d547970653a206170706c69636174696f6e2f7364700a416c6c6f773a20494e564954452c2041434b2c204259452c2043414e43454c2c20494e464f2c204f5054494f4e532c2052454749535445522c204e4f544946590a537570706f727465643a207265706c616365732c206f7574626f756e640a0a763d300a6f3d2d2030203020494e20495034203232302e3137312e312e3136350a733d2d0a633d494e20495034203232302e3137312e312e3136350a6d3d766964656f203234383430205254502f415650203130300a613d7274706d61703a31303020482e3236342f39303030300a613d666d74703a313030204349463d313b344349463d313b463d313b4b3d310a613d726563766f6e6c790a613d726174653a6d61696e0a";
         int counter = 0;
        for(int i = 0; i < hexStr.length() - 1; i = i + 2){
            counter++;
            cout << "0x" << hexStr.c_str()[i] << hexStr.c_str()[i+1] << ",";
        }
    
        cout << endl << counter << endl;
}


int main(int argc, const char * argv[]) {
    formatHex();
    cout << std::string((char*)cSip) << endl;

    SIPUtil siputil;
    int new_sip_length = 0;
    
    string ip = siputil.getInviteToIpForDialIp((char *)cSip, cSip_length);
    cout << "<<<<<<<<<<<<<<<<<<<<<<<<<" << ip << endl;
    
//    string old_ip = siputil.get_invite_platform_video_ip((char *)cSip, cSip_length);
//    cout << "<<<<<<<<<<<<<<<<<<<<<<<<<" << old_ip << endl;
    
//
//    shared_ptr<char> new_sip = siputil.change_invite_ip((char *)cSip, cSip_length, "127.0.0.1", "0.0.0.1:9001", new_sip_length);
//    printf(">>>>>>>>>>>>>>> \n\n %s", new_sip.get());

//    shared_ptr<char> new_sip = siputil.change_notify_ip((char *)cSip, cSip_length, "127.0.0.1:9001", new_sip_length);
//
//     printf("%s", new_sip.get());
    
//    string new_sip = siputil.change_control_camera_ip((char *)cSip, cSip_length, "127.0.0.1", "127.0.0.1:9000", "0.0.0.0");
//    cout << new_sip << endl;
    
//    shared_ptr<char> new_sip =  siputil.change_register_ip((char *)cSip, cSip_length, "127.0.0.1", new_sip_length);
    
//    shared_ptr<char> new_sip = siputil.change_invite_ip_200ok((char *)cSip, cSip_length, "127.0.0.1", "127.0.0.1:9000", new_sip_length);
    
//    if(new_sip == nullptr) {
//
//    }else {
//         printf("%s", new_sip.get());
//    }

    
//    string new_sip = siputil.change_control_camera_ip((char*)cSip, cSip_length, "127.0.0.1", "127.0.0.1:8000", "0.0.0.0:5060");
//       cout << new_sip << endl;
//
//    string subscrib_ok_200 = siputil.get_subscrit_200_ok(cSip, cSip_length);
//    cout << subscrib_ok_200 << endl;
    
    
//    shared_ptr<char> new_sip = siputil.change_rtsp_ip_200ok(cSip, cSip_length, "127.0.0.1", "8.8.8.8", new_sip_length);
//    printf("%s", new_sip.get());
    
//     if(siputil.is_event_type(cSip, cSip_length, "Push_Resourse")) {
//         shared_ptr<char> new_sip = siputil.makeBatteryNotify(cSip, cSip_length, new_sip_length);
//         printf("%s", new_sip.get());
//     }

//    printBuffer(new_sip.get(), new_sip_length, "");
    
//    if(siputil.is_event_type(cSip, cSip_length, "Response_History_Video")) {
//        shared_ptr<char> new_sip = siputil.change_replay_ip(cSip, cSip_length, "127.0.0.1:554", new_sip_length);
//        printf("%s", new_sip.get());
//        printBuffer(new_sip.get(), new_sip_length, "");
//    }
    return 0;
}


